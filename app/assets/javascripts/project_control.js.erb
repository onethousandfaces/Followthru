/** Project type keys */
var ProjectTypes = {
  'new' : { key : 0, items : [], count : 0 },
  'active' : { key : 1, items : [], count : 0 },
  'success' : { key : 2, items : [], count : 0 },
  'failed' : { key : 3, items : [], count : 0 },
  'closed' : { key : 4, items : [], count : 0 }
};

/** Controller for new project form */
var CreateProjectController = function($scope, Project) {
  $scope.project = new Project();
  $scope.hasErrors = false;
  $scope.errors = {};
  $scope.success = false;
  $scope.public = true;

  /* Default values */
  $scope.project.objective = "Idea";
  $scope.project.name = "Project name";
  $scope.project.desc = "Project description";

  /** Create the project or list errors */
  $scope.create = function() {
    $scope.project.private = !$scope.public;
    $scope.project.$create(function(data) {
      $scope.success = true;
      $scope.hasErrors = false;
    }, function(data) {
      var data = appErrorsAsArray(data);
      $scope.errors = data;
      $scope.hasErrors = data.length;
    });
  };
}

CreateProjectController.$inject = ['$scope', 'Project'];

/** Controller for list project form */
var ListProjectController = function($scope, Project) {
  $scope.nav = function(url) { document.location = url; }
  $scope.projects = ProjectTypes;

  Project.query(function(data) {
    for (var d in data) {

      /* update urls for each item */
      data[d].viewUrl = ListProjectControllerData.baseViewUrl + "/" + data[d].id;
      data[d].editUrl = ListProjectControllerData.baseEditUrl + "/" + data[d].id;
      data[d].deleteUrl = ListProjectControllerData.baseDeleteUrl + "/" + data[d].id;

      /* split into status batches */
      for (var t in $scope.projects) {
        if (data[d].status == $scope.projects[t].key) {
          data[d].status = t;
          $scope.projects[t].items.push(data[d]);
        }
      }
    }

    /* update project counts */
    for (var t in $scope.projects) {
      $scope.projects[t].count = $scope.projects[t].items.length;
    }
  });
}

ListProjectController.$inject = ['$scope', 'Project'];

/** Controller for view project form */
var ViewProjectController = function($scope, Project) {
  $scope.valid = true;
  $scope.project = new Project()
  Project.get({id:ViewProjectControllerData.id}, function(data) {
    for (var t in ProjectTypes) {
      if (data.status == ProjectTypes[t].key) {
        data.status = t;
        break;
      }
    }
    $scope.project = data;
  }, function() {
    $scope.valid = false;
  });
}

ViewProjectController.$inject = ['$scope', 'Project'];
