/** Controller for new project form */
var CreateProjectController = function($scope, Project) {
  $scope.project = new Project();
  $scope.hasErrors = false;
  $scope.errors = {};
  $scope.success = false;

  /** Create the project or list errors */
  $scope.create = function() {
    $scope.project.$create(function(data) {
      $scope.success = true;
      $scope.hasErrors = false;
    }, function(data) {
      var data = appErrorsAsArray(data);
      $scope.errors = data;
      $scope.hasErrors = data.length;
    });
  };
}

CreateProjectController.$inject = ['$scope', 'Project'];

/** Controller for list project form */
var ListProjectController = function($scope, Project) {
  $scope.nav = function(url) { document.location = url; }
  $scope.projects = {
    'new' : {items : [], count : 0 },
    'active' : {items : [], count : 0 },
    'success' : {items : [], count : 0 },
    'failed' : {items : [], count : 0 },
    'closed' : {items : [], count : 0 }
  };

  Project.query(function(data) {
    for (var d in data) {

      /* update urls for each item */
      data[d].viewUrl = ListProjectControllerData.baseViewUrl + "/" + data[d].id;
      data[d].editUrl = ListProjectControllerData.baseEditUrl + "/" + data[d].id;
      data[d].deleteUrl = ListProjectControllerData.baseDeleteUrl + "/" + data[d].id;

      /* split into status batches */
      if (data[d].status == 0) $scope.projects.new.items.push(data[d])
      else if (data[d].status == 1) $scope.projects.active.items.push(data[d])
      else if (data[d].status == 2) $scope.projects.success.items.push(data[d])
      else if (data[d].status == 3) $scope.projects.failed.items.push(data[d])
      else if (data[d].status == 4) $scope.projects.closed.items.push(data[d])
    }

    /* update project counts */
    $scope.projects.new.items.count = $scope.projects.new.items.length;
    $scope.projects.active.items.count = $scope.projects.active.items.length;
    $scope.projects.success.items.count = $scope.projects.success.items.length;
    $scope.projects.failed.items.count = $scope.projects.failed.items.length;
    $scope.projects.closed.items.count = $scope.projects.closed.items.length;
  });
}

ListProjectController.$inject = ['$scope', 'Project'];

/** Controller for view project form */
var ViewProjectController = function($scope, Project) {
  $scope.project = new Project()
  Project.get({id:ViewProjectControllerData.id}, function(data) {
    $scope.project = data;
  }, function() {
    alert("Bad id");
  });
}

ViewProjectController.$inject = ['$scope', 'Project'];
